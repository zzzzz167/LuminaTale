# Viviscript

## 前言
Viviscript(VVS) 作为本 galgame 引擎的脚本语言, 在设计初便准备面向低编程基础的开发者提供一套快速易上手的编写语法, 避免不必要的复杂性和冗余, 但同时也面向更加宽广的场景集成 Lua 进行高级操作, 暴露系统底层接口供实现更多扩展.

VVS 在一定程度上参考 ren'py 语法, 也希望 VVS 能成为类似 ren'py 的实用脚本语言.

# 规范
现在还没有 doc 先在此处列出 VVS 的语法规范.

先约定一些东西:
1. VVS 对缩进不敏感
2. 参数间用空格分割但在字符串内时空格不应该被视为分隔符
3. []代表可选可选参数使用
4. --作为单行注释开头其到行尾的全部内容都是注释 但是不能在字符串内使用-- 也不能在choice标题后使用注释这两种情况都会被视为是字符串的一部分
5. \作为转义符号但应只在字符串内转义,字符串外的\应正常理解
6. 单行:的后面的非空格的全部内容理应作为字符串无论在其之后出现多少冒号
7. 资源名称是由多个用空格分隔的单词组成

## 角色定义
使用 character 指令定义角色信息，包括角色名称、图片标签、语音标签。定义后可在剧情中直接引用角色名称及相关资源且不应放在任何label块中。

`character <角色标识符> name=<显示名称> [image_tag=<图片资源标签> voice_tag=<语音资源标签>]`

当定义角色后 角色标识符将无法作为正常的字面量理解,例如当show一个已经存在且定义了 image_tag 的角色表示符时将用 image_tag 作为图像前缀而非角色标识符的字面量

## 场景控制
使用 scene 指令来清空原图层切换游戏背景，可搭配其他指令实现动态效果

`scene <资源前缀> [<属性1> <属性2>...<属性n>] [with <切换效果>]` 例如 scene bg 天空 蓝色 对应的图片资源名称为"bg_天空_蓝色"

## 角色立绘
使用 show 和 hide 指令控制角色立绘的显示和隐藏

`show <角色标识符/图像前缀> [<属性1> <属性2>...<属性n>] [at <位置>] [with <切换效果>]` 

当角色标识符存在时使用 image_tag 作为图像前缀 with / at 关键字只能在一条语句中只能出现一次 可以交换位置

`show <角色标识符/图像前缀> -<属性n>` 通过该语句来移除属性

`hide <角色标识符/图像前缀>` 通过该语句来隐藏人物立绘

## 音频控制
通道包括背景音乐(music)、音效(sound)以及对白(voice)

`play <音乐通道> <音乐资源名称> [volume=<音量> fade_in=<淡入长度> loop/noloop]`

loop 与 noloop 只可选一个单次出现 若不指定则按通道默认来决定是否循环播放

`stop <音乐通道> [fade_out=<淡出长度>]`

## 对话与文本
角色发言对话

`<角色标识符/一次性显示名称>[@<别名>]:<对话内容>[(语音编号)]`

别名用来临时给角色指定一个替代显示名称(如用于悬疑或未知角色身份时),当别名出现特殊字符时需要加引号否则会解析错误,语音编号与 voice_tag 共同组成对白音频名称

```
单行叙述文本(旁白、描述)
:<叙述文本>

多行叙述文本
:"""<叙述文本>
<叙述文本>
<叙述文本>
""" --必须用三引号包裹,同时，三引号内部的--也不应该被当作注释,内部的缩进也会被省略
```

## 脚本标签
label 语句允许使用自定义的标签名声明一个程序点位。这些标签仅仅用来被调用或者跳转
```
label <标签名>
一些脚本内容
enlb
```

## 选项标签
```
choice <标题>
<第一个选项名称>:<指令>
<第二个选项名称>:<指令>
...
enco
```
目前只支持单行指令
## 跳转标签
`jump <目标标签名>`

直接跳转不会返回

`call <目标标签名>` 

跳转后仍会返回调用处继续运行

## lua脚本与变量
单行lua代码使用`$`开头

lua代码块

```
lua
<任意 Lua 代码>
enlua
```